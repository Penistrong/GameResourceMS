<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.Penistrong.GameResourceMS.user.personalConfig.mapper.PersonalConfigMapper">
	<update id="updateUserInfo">
		UPDATE user_accounts
		   SET <if test="introduction != '' and introduction != null">introduction = #{introduction}</if>
		   	   <if test=" user_name !='' and user_name != null ">,user_name = #{user_name}</if>
		 WHERE resource_id = #{resource_id}
		   AND user_id = #{user_id}
	</update>
	
	<update id="uploadPortrait">
		UPDATE user_moreinfos
		   SET portrait_id = #{portrait_id}, portrait = #{portrait}, upload_time = #{upload_time}
		 WHERE resource_id = #{resource_id}
		   AND user_id = #{user_id}
	</update>
	
	<select id="getPortrait" resultType="java.lang.String">
		SELECT portrait
		  FROM user_moreinfos
		 WHERE resource_id = #{resource_id}
		<if test="user_id != '' and user_id != null">	 
		   AND user_id = #{user_id}
		</if>
	</select>
	
	<select id="getUserPostsHistory" resultType="java.util.Map">
		SELECT a.poster_id,a.post_id,a.upload_time,a.post_title,a.post_subhead,b.visits,b.floors
		  FROM posts_base_info a
	INNER JOIN posts_extend_info b
			ON a.resource_id = b.resource_id AND a.post_id = b.post_id
	     WHERE a.resource_id = #{resource_id} 
	       AND a.poster_id = #{poster_id}
	  ORDER BY a.upload_time DESC
	</select>
	
	<delete id="deletePostBase">
		DELETE FROM posts_base_info
		 WHERE poster_id = #{poster_id}
		   AND post_id = #{post_id}
	</delete>
	
	<delete id="deletePostExtend">
		DELETE FROM posts_extend_info
	     WHERE post_id = #{post_id}
	</delete>
	
	<delete id="deletePostReply">
		DELETE FROM posts_reply
		 WHERE post_id = #{post_id}
	</delete>
</mapper>